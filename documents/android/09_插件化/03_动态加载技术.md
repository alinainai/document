## 一、动态加载

不管是热跟新、热修复、增量更新还是插件化，他们都是动态加载技术的实现。

和普通的 Java 程序不同的是，Android 程序还要考虑
- 资源文件的加载
- 四大组件的注册

Android 动态加载的难点就是需要一个上下文环境。


## 二、资源的加载流程

我们以 getText() 为例看下调用流程(SDK 32)。

### 1、相关类

Resources：Class for accessing an application's resources. 该类是用来访问应用资源的。  
ResourcesImpl：资源访问的实现类，Resources 是对该类进行的包裹。当配置发生变化时（如语言切换），Resources 可以是同一个，只重新创建 ResourcesImpl 即可。  
AssetManager： 提供了低等级的 API 用来加载打包进Bundle中的资源文件。 

### 2、相关代码

在 MainActivity 类中加载 string 资源文件

```kotlin
resources.getText(R.string.app_name)
```
getText() 代码如下，先通过 mResourcesImpl 获取 AssetManager 对象，然后使用 AssetManager 类中的相关方法做加载操作。
```java
#Resources.class
private Resources() {
    this(null);
    
    final DisplayMetrics metrics = new DisplayMetrics();
    metrics.setToDefaults();
    
    final Configuration config = new Configuration();
    config.setToDefaults();
    // 生成一个 ResourcesImpl 对象
    mResourcesImpl = new ResourcesImpl(AssetManager.getSystem(), metrics, config,
            new DisplayAdjustments());
}
// getText 加载文本资源
@NonNull public CharSequence getText(@StringRes int id) throws NotFoundException {
    CharSequence res = mResourcesImpl.getAssets().getResourceText(id);
    if (res != null) {
        return res;
    }
    throw new NotFoundException("String resource ID #0x"
            + Integer.toHexString(id));
}

#ResourcesImpl.class
public ResourcesImpl(@NonNull AssetManager assets, @Nullable DisplayMetrics metrics,
        @Nullable Configuration config, @NonNull DisplayAdjustments displayAdjustments) {
    mAssets = assets; // mAssets 在 ResourcesImpl 的构造方法中赋值
    mMetrics.setToDefaults();
    mDisplayAdjustments = displayAdjustments;
    mConfiguration.setToDefaults();
    updateConfiguration(config, metrics, displayAdjustments.getCompatibilityInfo());
}
```



## 3、热修复技术概念介绍

热修复，用户不需要安装新版本的APK，直接下载差异包实现该版本 bug 的修复。  
优点：不需要下载新版本的APK，减少用户流失。

### 1、几种主流热修复框架

1、qq空间的超级补丁方案  
2、微信的Tinker  
3、阿里的AndFix  
4、美团的 Robust  

### 2、





